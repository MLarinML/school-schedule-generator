# –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –≤—Ö–æ–¥–æ–º –≤ —Å–∏—Å—Ç–µ–º—É

## üêõ –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ—Å–ª–µ –≤–≤–æ–¥–∞ –ø–æ—á—Ç—ã –∏ –ø–∞—Ä–æ–ª—è –∏ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ "–í–æ–π—Ç–∏" –ø–æ—è–≤–ª—è–ª–æ—Å—å —Å–æ–æ–±—â–µ–Ω–∏–µ "–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ", –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–ø–∞–¥–∞–ª –≤ –ø—Ä–æ—Ñ–∏–ª—å –∏ –æ—Å—Ç–∞–≤–∞–ª—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ö–æ–¥–∞.

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
1. **–û—à–∏–±–∫–∞ –≤ API —Å–µ—Å—Å–∏–∏**: `TypeError: Cannot read properties of undefined (reading 'toISOString')`
2. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–ª–µ–º `lastSeenAt`**: –ü–æ–ª–µ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Å—Ö–µ–º—É, –Ω–æ —É —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–Ω–æ –±—ã–ª–æ `null`
3. **–û—à–∏–±–∫–∞ –≤ API –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è**: –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–º–ø–æ—Ä—Ç–∞–º–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

## ‚úÖ –†–µ—à–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –≤ API —Å–µ—Å—Å–∏–∏
**–§–∞–π–ª**: `app/api/auth/session/route.ts`
```typescript
// –ë—ã–ª–æ:
lastSeenAt: session.user.lastSeenAt.toISOString(),

// –°—Ç–∞–ª–æ:
lastSeenAt: session.user.lastSeenAt?.toISOString() || new Date().toISOString(),
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
**–°–∫—Ä–∏–ø—Ç**: `scripts/update-existing-users.js`
- –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ `lastSeenAt` –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –†–µ–∑—É–ª—å—Ç–∞—Ç: 4 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã

### 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –ø—Ä–æ—Ü–µ—Å—Å –≤—Ö–æ–¥–∞
- –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `testuser@example.com`
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω email –∞–¥—Ä–µ—Å
- –£—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
- –°–µ—Å—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
**–§–∞–π–ª**: `prisma/schema.prisma`
```prisma
model User {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  firstName           String?  @map("first_name")
  lastName            String?  @map("last_name")
  schoolName          String?  @map("school_name")
  language            String   @default("ru") @map("language")
  lastSeenAt          DateTime @default(now()) @map("last_seen_at")
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
}
```

### 5. –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–∏–ø—ã TypeScript
**–§–∞–π–ª**: `types/auth.ts`
```typescript
export interface User {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  firstName?: string
  lastName?: string
  schoolName?: string
  language?: string
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –£—Å–ø–µ—à–Ω—ã–µ —Ç–µ—Å—Ç—ã:
1. ‚úÖ –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É —Ä–∞–±–æ—Ç–∞–µ—Ç
2. ‚úÖ –°–µ—Å—Å–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç
4. ‚úÖ –ù–æ–≤—ã–µ –ø–æ–ª—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ API —Å–µ—Å—Å–∏–∏
5. ‚úÖ API –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
6. ‚úÖ Prisma –∫–ª–∏–µ–Ω—Ç –æ–±–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 6. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å Prisma –∫–ª–∏–µ–Ω—Ç–æ–º
**–ü—Ä–æ–±–ª–µ–º–∞**: `Unknown argument 'firstName'` - Prisma –Ω–µ –≤–∏–¥–µ–ª –Ω–æ–≤—ã–µ –ø–æ–ª—è
**–†–µ—à–µ–Ω–∏–µ**: 
- –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `npx prisma generate` –¥–ª—è –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞
- –ü–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —Å–µ—Ä–≤–µ—Ä Next.js –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Ä–∞–±–æ—Ç–∞ API –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è

### –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:
- **–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- **–°–µ—Å—Å–∏—è**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —á–µ—Ä–µ–∑ API**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- **–§–æ—Ä–º–∞ –ø—Ä–æ—Ñ–∏–ª—è**: ‚úÖ –ì–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç
–í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω—ã**. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–µ–ø–µ—Ä—å –º–æ–≥—É—Ç:
- –£—Å–ø–µ—à–Ω–æ –≤—Ö–æ–¥–∏—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É
- –í–∏–¥–µ—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Å–µ—Å—Å–∏–∏
- –û–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–æ—Ñ–∏–ª—å —á–µ—Ä–µ–∑ API
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
1. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º—É –ø—Ä–æ—Ñ–∏–ª—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. ‚úÖ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤–æ –≤–∫–ª–∞–¥–∫–µ "–û–±–∑–æ—Ä"
